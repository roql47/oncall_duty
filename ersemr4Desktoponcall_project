warning: in the working copy of 'chatbot_webapp/backend/main.py', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/chatbot_webapp/backend/main.py b/chatbot_webapp/backend/main.py[m
[1mindex 3168108..150fb09 100644[m
[1m--- a/chatbot_webapp/backend/main.py[m
[1m+++ b/chatbot_webapp/backend/main.py[m
[36m@@ -335,6 +335,83 @@[m [mdef is_follow_up_question(message: str):[m
     print(f"     âŒ í›„ì† ì§ˆë¬¸ íŒ¨í„´ì— ë§¤ì¹˜ë˜ì§€ ì•ŠìŒ")[m
     return False[m
 [m
[32m+[m
[32m+[m[32m# =============================================================================[m
[32m+[m[32m# ë¶€ì„œ ì¶”ì²œ í•¨ìˆ˜ë“¤[m
[32m+[m[32m# =============================================================================[m
[32m+[m
[32m+[m[32mdef find_similar_departments(query_dept: str, all_departments: list) -> list:[m
[32m+[m[32m    """ì‚¬ìš©ì ì§ˆë¬¸ì—ì„œ ì¶”ì¶œí•œ ë¶€ì„œëª…ê³¼ ìœ ì‚¬í•œ ì‹¤ì œ ë¶€ì„œë“¤ì„ ì°¾ì•„ ì¶”ì²œ"""[m
[32m+[m[32m    if not query_dept or not all_departments:[m
[32m+[m[32m        return [][m
[32m+[m[41m    [m
[32m+[m[32m    similar_depts = [][m
[32m+[m[32m    query_lower = query_dept.lower()[m
[32m+[m[41m    [m
[32m+[m[32m    print(f"ğŸ” ë¶€ì„œ ì¶”ì²œ ê²€ìƒ‰: '{query_dept}'")[m
[32m+[m[32m    print(f"   ì „ì²´ ë¶€ì„œ ìˆ˜: {len(all_departments)}ê°œ")[m
[32m+[m[41m    [m
[32m+[m[32m    # 1. ë¶€ë¶„ ë§¤ì¹­ - ì§ˆë¬¸í•œ ë‹¨ì–´ê°€ ë¶€ì„œëª…ì— í¬í•¨ëœ ê²½ìš°[m
[32m+[m[32m    for dept in all_departments:[m
[32m+[m[32m        if query_dept in dept:[m
[32m+[m[32m            similar_depts.append(dept)[m
[32m+[m[32m            print(f"   âœ… ë¶€ë¶„ ë§¤ì¹­: '{dept}' ('{query_dept}' í¬í•¨)")[m
[32m+[m[41m    [m
[32m+[m[32m    # 2. í‚¤ì›Œë“œ ê¸°ë°˜ ë§¤ì¹­[m
[32m+[m[32m    keyword_mappings = {[m
[32m+[m[32m        'ì™¸ê³¼': ['ì™¸ê³¼', 'ìˆ˜ìˆ '],[m
[32m+[m[32m        'ë‚´ê³¼': ['ë‚´ê³¼', 'ë‚´ì‹œê²½'],[m
[32m+[m[32m        'ì†Œì•„': ['ì†Œì•„', 'ì•„ì´', 'ì–´ë¦°ì´'],[m
[32m+[m[32m        'ì •ì‹ ': ['ì •ì‹ ', 'ì‹¬ë¦¬'],[m
[32m+[m[32m        'í”¼ë¶€': ['í”¼ë¶€', 'ì„±í˜•'],[m
[32m+[m[32m        'ì•ˆê³¼': ['ì•ˆê³¼', 'ëˆˆ'],[m
[32m+[m[32m        'ì´ë¹„ì¸í›„ê³¼': ['ì´ë¹„ì¸í›„ê³¼', 'ê·€', 'ì½”', 'ëª©'],[m
[32m+[m[32m        'ì‚°ë¶€ì¸ê³¼': ['ì‚°ë¶€ì¸ê³¼', 'ì‚°ê³¼', 'ë¶€ì¸ê³¼', 'ì—¬ì„±'],[m
[32m+[m[32m        'ë¹„ë‡¨ê¸°ê³¼': ['ë¹„ë‡¨ê¸°ê³¼', 'ë¹„ë‡¨'],[m
[32m+[m[32m        'ì‘ê¸‰': ['ì‘ê¸‰', 'ER', 'ì‘ê¸‰ì‹¤'],[m
[32m+[m[32m        'ì¤‘í™˜ì': ['ì¤‘í™˜ì', 'ICU', 'ì§‘ì¤‘ì¹˜ë£Œ'],[m
[32m+[m[32m        'ì¬í™œ': ['ì¬í™œ', 'ë¬¼ë¦¬ì¹˜ë£Œ'],[m
[32m+[m[32m        'ë§ˆì·¨': ['ë§ˆì·¨', 'ìˆ˜ìˆ '],[m
[32m+[m[32m        'ì˜ìƒ': ['ì˜ìƒ', 'ë°©ì‚¬ì„ ', 'CT', 'MRI'],[m
[32m+[m[32m        'ë³‘ë¦¬': ['ë³‘ë¦¬', 'ê²€ì‚¬'][m
[32m+[m[32m    }[m
[32m+[m[41m    [m
[32m+[m[32m    # í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ ì¶”ê°€ ë¶€ì„œ ì°¾ê¸°[m
[32m+[m[32m    for keyword, related_words in keyword_mappings.items():[m
[32m+[m[32m        if any(word in query_lower for word in related_words):[m
[32m+[m[32m            for dept in all_departments:[m
[32m+[m[32m                if keyword in dept and dept not in similar_depts:[m
[32m+[m[32m                    similar_depts.append(dept)[m
[32m+[m[32m                    print(f"   âœ… í‚¤ì›Œë“œ ë§¤ì¹­: '{dept}' (í‚¤ì›Œë“œ: {keyword})")[m
[32m+[m[41m    [m
[32m+[m[32m    print(f"   ğŸ“‹ ì´ {len(similar_depts)}ê°œ ë¶€ì„œ ë°œê²¬: {similar_depts}")[m
[32m+[m[32m    return similar_depts[m
[32m+[m
[32m+[m[32mdef create_department_recommendation_response(query_dept: str, similar_depts: list) -> str:[m
[32m+[m[32m    """ë¶€ì„œ ì¶”ì²œ ì‘ë‹µ ë©”ì‹œì§€ ìƒì„±"""[m
[32m+[m[32m    if not similar_depts:[m
[32m+[m[32m        return f"ì£„ì†¡í•©ë‹ˆë‹¤. '{query_dept}'ì™€ ê´€ë ¨ëœ ì§„ë£Œê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."[m
[32m+[m[41m    [m
[32m+[m[32m    if len(similar_depts) == 1:[m
[32m+[m[32m        # í•˜ë‚˜ë§Œ ë°œê²¬ëœ ê²½ìš°[m
[32m+[m[32m        return f"'{query_dept}'ì™€ ê´€ë ¨í•˜ì—¬ **{similar_depts[0]}**ì„(ë¥¼) ì°¾ì•˜ìŠµë‹ˆë‹¤.\n\në‹¤ì‹œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”:\nğŸ’¡ ì˜ˆì‹œ: \"{similar_depts[0]} ë‹¹ì§ ëˆ„êµ¬ì•¼?\""[m
[32m+[m[41m    [m
[32m+[m[32m    # ì—¬ëŸ¬ ê°œ ë°œê²¬ëœ ê²½ìš°[m
[32m+[m[32m    response_lines = [f"'{query_dept}'ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ ì§„ë£Œê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤:"][m
[32m+[m[32m    response_lines.append("")[m
[32m+[m[41m    [m
[32m+[m[32m    for i, dept in enumerate(similar_depts[:5], 1):  # ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ[m
[32m+[m[32m        response_lines.append(f"{i}. **{dept}**")[m
[32m+[m[41m    [m
[32m+[m[32m    if len(similar_depts) > 5:[m
[32m+[m[32m        response_lines.append(f"... ì™¸ {len(similar_depts) - 5}ê°œ ë”")[m
[32m+[m[41m    [m
[32m+[m[32m    response_lines.append("")[m
[32m+[m[32m    response_lines.append("êµ¬ì²´ì ì¸ ì§„ë£Œê³¼ëª…ìœ¼ë¡œ ë‹¤ì‹œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”:")[m
[32m+[m[32m    response_lines.append(f"ğŸ’¡ ì˜ˆì‹œ: \"{similar_depts[0]} ë‹¹ì§ ëˆ„êµ¬ì•¼?\"")[m
[32m+[m[41m    [m
[32m+[m[32m    return "\n".join(response_lines)[m
[32m+[m
 def extract_follow_up_reference(message: str):[m
     """í›„ì† ì§ˆë¬¸ì—ì„œ ì°¸ì¡° ì •ë³´ ì¶”ì¶œ (ì‹œê°„, ì—°ë½ì²˜ ë“±)"""[m
     message_clean = message.strip()[m
[36m@@ -666,6 +743,15 @@[m [mif not static_dir.exists():[m
 [m
 app.mount("/static", StaticFiles(directory=str(static_dir)), name="static")[m
 [m
[32m+[m[32m# ëª¨ë“  ìš”ì²­ ë¡œê¹… ë¯¸ë“¤ì›¨ì–´[m
[32m+[m[32m@app.middleware("http")[m
[32m+[m[32masync def log_requests(request: Request, call_next):[m
[32m+[m[32m    print(f"ğŸŒ ìš”ì²­ ìˆ˜ì‹ : {request.method} {request.url}")[m
[32m+[m[32m    print(f"   í´ë¼ì´ì–¸íŠ¸ IP: {request.client.host if request.client else 'unknown'}")[m
[32m+[m[32m    response = await call_next(request)[m
[32m+[m[32m    print(f"   ì‘ë‹µ ìƒíƒœ: {response.status_code}")[m
[32m+[m[32m    return response[m
[32m+[m
 # CORS ì„¤ì • (í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ìš©)[m
 app.add_middleware([m
     CORSMiddleware,[m
[36m@@ -1209,6 +1295,58 @@[m [mdef parse_date_reference(message: str):[m
     elif "ì˜¤ëŠ˜" in message:[m
         return today.strftime('%Y-%m-%d')[m
     [m
[32m+[m[32m    # ì›” ê´€ë ¨ í‚¤ì›Œë“œ ì²˜ë¦¬ ('ë‹¤ìŒë‹¬', 'ì €ë²ˆë‹¬', 'ì´ë²ˆë‹¬', '9ì›”' ë“±)[m
[32m+[m[32m    month_patterns = [[m
[32m+[m[32m        (r"ë‹¤ìŒ\s*ë‹¬", 1),    # ë‹¤ìŒë‹¬[m
[32m+[m[32m        (r"ì €ë²ˆ\s*ë‹¬", -1),   # ì €ë²ˆë‹¬[m
[32m+[m[32m        (r"ì§€ë‚œ\s*ë‹¬", -1),   # ì§€ë‚œë‹¬[m
[32m+[m[32m        (r"ì´ë²ˆ\s*ë‹¬", 0),    # ì´ë²ˆë‹¬[m
[32m+[m[32m        (r"(\d{1,2})ì›”", None)  # íŠ¹ì • ì›” (9ì›” ë“±)[m
[32m+[m[32m    ][m
[32m+[m[41m    [m
[32m+[m[32m    for pattern, month_offset in month_patterns:[m
[32m+[m[32m        match = re.search(pattern, message)[m
[32m+[m[32m        if match:[m
[32m+[m[32m            if month_offset is not None:  # ìƒëŒ€ì  ì›” (ë‹¤ìŒë‹¬, ì €ë²ˆë‹¬ ë“±)[m
[32m+[m[32m                current_month = today.month[m
[32m+[m[32m                current_year = today.year[m
[32m+[m[41m                [m
[32m+[m[32m                target_month = current_month + month_offset[m
[32m+[m[32m                target_year = current_year[m
[32m+[m[41m                [m
[32m+[m[32m                # ì›”ì´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ê²½ìš° ì—°ë„ ì¡°ì •[m
[32m+[m[32m                if target_month > 12:[m
[32m+[m[32m                    target_month = target_month - 12[m
[32m+[m[32m                    target_year += 1[m
[32m+[m[32m                elif target_month < 1:[m
[32m+[m[32m                    target_month = target_month + 12[m
[32m+[m[32m                    target_year -= 1[m
[32m+[m[41m                [m
[32m+[m[32m                # í•´ë‹¹ ì›”ì˜ ì²«ì§¸ ë‚ ë¡œ ì„¤ì • (ë‹¹ì§ ì§ˆë¬¸ì—ì„œëŠ” ë³´í†µ íŠ¹ì • ì¼ìë³´ë‹¤ëŠ” ì›” ì „ì²´ë¥¼ ì˜ë¯¸)[m
[32m+[m[32m                target_date = datetime(target_year, target_month, 1)[m
[32m+[m[41m                [m
[32m+[m[32m                month_names = {1: 'ë‹¤ìŒë‹¬', -1: 'ì €ë²ˆë‹¬/ì§€ë‚œë‹¬', 0: 'ì´ë²ˆë‹¬'}[m
[32m+[m[32m                print(f"'{month_names.get(month_offset)}' í‚¤ì›Œë“œ ê°ì§€ë¨ - ë‚ ì§œ ë³€í™˜: {target_date.strftime('%Y-%m-%d')} ({target_year}ë…„ {target_month}ì›”)")[m
[32m+[m[32m                return target_date.strftime('%Y-%m-%d')[m
[32m+[m[32m            else:  # íŠ¹ì • ì›” (9ì›” ë“±)[m
[32m+[m[32m                month_num = int(match.group(1))[m
[32m+[m[32m                current_year = today.year[m
[32m+[m[32m                current_month = today.month[m
[32m+[m[41m                [m
[32m+[m[32m                # í˜„ì¬ ì›”ë³´ë‹¤ ì´ì „ ì›”ì´ë©´ ë‚´ë…„ìœ¼ë¡œ, ì´í›„ ì›”ì´ë©´ ì˜¬í•´ë¡œ ì„¤ì •[m
[32m+[m[32m                if month_num < current_month:[m
[32m+[m[32m                    target_year = current_year + 1[m
[32m+[m[32m                else:[m
[32m+[m[32m                    target_year = current_year[m
[32m+[m[41m                [m
[32m+[m[32m                try:[m
[32m+[m[32m                    target_date = datetime(target_year, month_num, 1)[m
[32m+[m[32m                    print(f"'{month_num}ì›”' í‚¤ì›Œë“œ ê°ì§€ë¨ - ë‚ ì§œ ë³€í™˜: {target_date.strftime('%Y-%m-%d')} ({target_year}ë…„ {month_num}ì›”)")[m
[32m+[m[32m                    return target_date.strftime('%Y-%m-%d')[m
[32m+[m[32m                except ValueError:[m
[32m+[m[32m                    print(f"ìœ íš¨í•˜ì§€ ì•Šì€ ì›”: {month_num}")[m
[32m+[m[32m                    continue[m
[32m+[m[41m    [m
     # '2025ë…„ 6ì›” 15ì¼' í˜•ì‹ ì²˜ë¦¬ (í•œê¸€ ì—°ë„ í¬í•¨)[m
     year_date_pattern = re.search(r'(\d{4})ë…„\s*(\d{1,2})ì›”\s*(\d{1,2})ì¼', message)[m
     if year_date_pattern:[m
[36m@@ -1316,6 +1454,8 @@[m [masync def generate_gemini_response(query: str, context: str):[m
 @app.post("/rag")[m
 async def rag_query(req: RAGRequest):[m
     """RAG ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ì—”ë“œí¬ì¸íŠ¸"""[m
[32m+[m[32m    print("ğŸ”ğŸ”ğŸ” RAG ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œë¨! ğŸ”ğŸ”ğŸ”")[m
[32m+[m[32m    print(f"RAG ìš”ì²­ ì¿¼ë¦¬: {req.query}")[m
     try:[m
         if vector_store is None:[m
             return {"status": "error", "message": "ë²¡í„° DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."}[m
[36m@@ -1588,6 +1728,28 @@[m [masync def rag_query(req: RAGRequest):[m
         traceback.print_exc()[m
         return {"status": "error", "message": f"ì˜¤ë¥˜ ë°œìƒ: {str(e)}"}[m
 [m
[32m+[m[32m# ë£¨íŠ¸ ê²½ë¡œ - ë©”ì¸ ì±—ë´‡ ì¸í„°í˜ì´ìŠ¤[m
[32m+[m[32m@app.get("/", response_class=HTMLResponse)[m
[32m+[m[32masync def get_chatbot_interface():[m
[32m+[m[32m    """ë©”ì¸ ì±—ë´‡ ì›¹ ì¸í„°í˜ì´ìŠ¤"""[m
[32m+[m[32m    html_file = static_dir / "index.html"[m
[32m+[m[32m    if html_file.exists():[m
[32m+[m[32m        with open(html_file, "r", encoding="utf-8") as f:[m
[32m+[m[32m            return f.read()[m
[32m+[m[32m    else:[m
[32m+[m[32m        return """[m
[32m+[m[32m        <html>[m
[32m+[m[32m            <head>[m
[32m+[m[32m                <title>ë‹¹ì§ ìŠ¤ì¼€ì¤„ ì±—ë´‡</title>[m
[32m+[m[32m            </head>[m
[32m+[m[32m            <body>[m
[32m+[m[32m                <h1>ë‹¹ì§ ìŠ¤ì¼€ì¤„ ì±—ë´‡</h1>[m
[32m+[m[32m                <p>ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>[m
[32m+[m[32m                <p><a href="/static/index.html">ì§ì ‘ ë§í¬</a></p>[m
[32m+[m[32m            </body>[m
[32m+[m[32m        </html>[m
[32m+[m[32m        """[m
[32m+[m
 # Gemini RAG ì›¹ ì¸í„°í˜ì´ìŠ¤[m
 @app.get("/gemini-rag", response_class=HTMLResponse)[m
 async def get_gemini_rag():[m
[36m@@ -1933,6 +2095,8 @@[m [masync def delete_vector_db():[m
 [m
 @app.post("/chat")[m
 async def chat(req: ChatRequest, request: Request):[m
[32m+[m[32m    print("ğŸš€ğŸš€ğŸš€ CHAT ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œë¨! ğŸš€ğŸš€ğŸš€")[m
[32m+[m[32m    print(f"ìš”ì²­ ë©”ì‹œì§€: {req.message}")[m
     start_time = time.time()  # ì‘ë‹µ ì‹œê°„ ì¸¡ì • ì‹œê°„[m
     [m
     # ì„¸ì…˜ ID ì²˜ë¦¬ ê°œì„  - ìš”ì²­ bodyì™€ í—¤ë” ëª¨ë‘ì—ì„œ í™•ì¸[m
[36m@@ -1970,6 +2134,7 @@[m [masync def chat(req: ChatRequest, request: Request):[m
     [m
     try:[m
         message = req.message[m
[32m+[m[41m        [m
         current_datetime = datetime.now()[m
         print(f"\n===== ìƒˆ ì±„íŒ… ìš”ì²­: '{message}' =====")[m
         print(f"===== í˜„ì¬ ì‹œê°„: {current_datetime} =====")[m
[36m@@ -2261,28 +2426,44 @@[m [masync def chat(req: ChatRequest, request: Request):[m
         # ë¶€ì„œ ì—°ë½ì²˜ ì§ˆë¬¸ì¸ì§€ ìš°ì„  í™•ì¸ (ë” ì¼ë°˜ì ì¸ íŒ¨í„´)[m
         # "ì •í˜•ì™¸ê³¼ ë‹¹ì§ì˜ ë²ˆí˜¸ëŠ”?" ê°™ì€ íŒ¨í„´ì„ ì •í™•íˆ ë§¤ì¹­[m
         # ë¶€ì„œëª…ê³¼ ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ì¶”ì¶œ[m
[31m-        dept_contact_pattern = re.search(r'(?:ì§€ê¸ˆ|í˜„ì¬)?\s*([ê°€-í£\s]+(?:ê³¼|ì‹¤|ì„¼í„°|ë¶€ì„œ))\s*(?:ë‹¹ì§ì˜?)?\s*(?:ì—°ë½ì²˜|ì „í™”ë²ˆí˜¸|ë²ˆí˜¸)\s*(?:ì•Œë ¤ì¤˜|ë­ì•¼|ëŠ”|ì€)', message)[m
[32m+[m[32m        dept_contact_pattern = re.search(r'(?:ì§€ê¸ˆ|í˜„ì¬)?\s*([ê°€-í£\s]+(?:ê³¼|ì‹¤|ì„¼í„°|ë¶€ì„œ|ë‹¹ì§ì˜|ë‹´ë‹¹ì˜))\s*(?:ì—°ë½ì²˜|ì „í™”ë²ˆí˜¸|ë²ˆí˜¸)\s*(?:ì•Œë ¤ì¤˜|ë­ì•¼|ëŠ”|ì€)', message)[m
         if dept_contact_pattern:[m
             dept_mention = dept_contact_pattern.group(1).strip()[m
             # "ì§€ê¸ˆ"ì´ë‚˜ "í˜„ì¬" ê°™ì€ ì‹œê°„ í‚¤ì›Œë“œ ì œê±°[m
             dept_mention_clean = re.sub(r'^(?:ì§€ê¸ˆ|í˜„ì¬)\s*', '', dept_mention).strip()[m
[32m+[m[32m            # ë¶€ì„œëª…ì—ì„œ ì—­í•  ë¶€ë¶„ ì œê±° ("ë‹¹ì§ì˜", "ë‹´ë‹¹ì˜" ë“±)[m
[32m+[m[32m            dept_mention_clean = re.sub(r'\s*(?:ë‹¹ì§ì˜|ë‹´ë‹¹ì˜|ìˆ˜ìˆ ì˜)\s*$', '', dept_mention_clean).strip()[m
             print(f"===== ë¶€ì„œ ì—°ë½ì²˜ ì§ˆë¬¸ ê°ì§€: '{dept_mention}' â†’ ì •ë¦¬: '{dept_mention_clean}' =====")[m
             [m
             # ë¶€ì„œëª… ë§¤ì¹­ ì‹œë„ (ë” ì •í™•í•œ ë§¤ì¹­)[m
             departments = await get_all_departments_async()[m
             print(f"     ì „ì²´ ë¶€ì„œ ëª©ë¡: {departments}")[m
[32m+[m[41m            [m
[32m+[m[32m            # ë™ì  ë³„ì¹­ ë§¤í•‘ ìƒì„±[m
[32m+[m[32m            department_aliases = await generate_department_aliases_async(departments)[m
[32m+[m[41m            [m
             matched_dept = None[m
             [m
[32m+[m[32m            # 0. ë³„ì¹­ ë§¤í•‘ ë¨¼ì € í™•ì¸ (ì •í™•í•œ ë‹¨ì–´ ë§¤ì¹­)[m
[32m+[m[32m            for alias, official_name in department_aliases.items():[m
[32m+[m[32m                # ë‹¨ì–´ ê²½ê³„ë¥¼ ê³ ë ¤í•œ ì •í™•í•œ ë§¤ì¹­[m
[32m+[m[32m                pattern = r'\b' + re.escape(alias) + r'\b'[m
[32m+[m[32m                if re.search(pattern, dept_mention_clean):[m
[32m+[m[32m                    matched_dept = official_name[m
[32m+[m[32m                    print(f"     âœ… ë¶€ì„œ ë³„ì¹­ ë§¤í•‘: '{alias}' â†’ '{official_name}'")[m
[32m+[m[32m                    break[m
[32m+[m[41m            [m
             # ë¶€ì„œëª…ì„ ê¸¸ì´ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ë” êµ¬ì²´ì ì¸ ë¶€ì„œëª… ìš°ì„ )[m
             sorted_departments = sorted(departments, key=len, reverse=True)[m
             print(f"     ê¸¸ì´ìˆœ ì •ë ¬ëœ ë¶€ì„œ ëª©ë¡: {sorted_departments}")[m
             [m
[31m-            # 1. ì™„ì „ ì¼ì¹˜ ìš°ì„  (dept_mention_cleanê³¼ ì •í™•íˆ ì¼ì¹˜)[m
[31m-            for dept in sorted_departments:[m
[31m-                if dept == dept_mention_clean:[m
[31m-                    matched_dept = dept[m
[31m-                    print(f"     âœ… ì™„ì „ ì¼ì¹˜: '{dept}'")[m
[31m-                    break[m
[32m+[m[32m            # 1. ì™„ì „ ì¼ì¹˜ ìš°ì„  (dept_mention_cleanê³¼ ì •í™•íˆ ì¼ì¹˜) - ë³„ì¹­ ë§¤í•‘ì´ ì—†ëŠ” ê²½ìš°ë§Œ[m
[32m+[m[32m            if not matched_dept:[m
[32m+[m[32m                for dept in sorted_departments:[m
[32m+[m[32m                    if dept == dept_mention_clean:[m
[32m+[m[32m                        matched_dept = dept[m
[32m+[m[32m                        print(f"     âœ… ì™„ì „ ì¼ì¹˜: '{dept}'")[m
[32m+[m[32m                        break[m
             [m
             # 2. ì¶”ì¶œëœ ë¶€ì„œëª…ì—ì„œ ë¶€ì„œëª… í¬í•¨ ì—¬ë¶€ í™•ì¸ (ë” êµ¬ì²´ì ì¸ ê²ƒ ìš°ì„ )[m
             if not matched_dept:[m
[36m@@ -2310,11 +2491,12 @