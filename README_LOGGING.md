# 📝 챗봇 대화 로깅 시스템

## 🎯 개요
당직 시스템의 챗봇 대화 내역을 자동으로 기록하고 분석할 수 있는 로깅 시스템입니다.

## 📂 로그 저장 위치
```
logs/
└── fastapi/
    └── chatbot/
        ├── fastapi_chatbot_2024-01-15.log
        ├── fastapi_chatbot_2024-01-16.log
        └── ...
```

## 📋 로그 포맷
```json
{
  "timestamp": "2024-01-15T14:30:45.123456",
  "level": "INFO",
  "logger": "fastapi_chatbot",
  "message": "챗봇 대화",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "user_message": "오늘 순환기내과 당직 누구야?",
  "bot_response": "오늘 순환기내과 당직은 홍길동 입니다.",
  "response_time": 1250.5,
  "ip_address": "127.0.0.1",
  "message_length": 18,
  "response_length": 22,
  "entities": {
    "date": "2024-01-15",
    "department": "순환기내과"
  }
}
```

## 🔐 개인정보 보호
자동으로 민감한 정보가 마스킹됩니다:
- **전화번호**: `010-1234-5678` → `010-****-5678`
- **주민번호**: `123456-1234567` → `123456-*******`
- **이메일**: `user@domain.com` → `u***@domain.com`

## 📊 포함되는 정보
- **세션 ID**: 대화 세션 추적
- **사용자 메시지**: 질문 내용 (민감정보 마스킹)
- **봇 응답**: 챗봇 답변
- **응답 시간**: 처리 시간 (밀리초)
- **IP 주소**: 사용자 접속 IP
- **메시지 길이**: 입력/출력 텍스트 길이
- **추출된 엔티티**: 부서, 날짜, 역할 등

## 🛠️ 활용 방법

### 1. 웹 로그 뷰어
- URL: `/schedule/logs/`
- 백엔드: FastAPI
- 로그 타입: Chatbot 선택

### 2. 명령줄 도구
```bash
# 챗봇 로그 조회
python logs/log_manager.py view fastapi chatbot

# 실시간 모니터링
python logs/log_manager.py tail fastapi chatbot

# 특정 날짜 로그 조회
python logs/log_manager.py view fastapi chatbot --date 2024-01-15 --lines 100
```

### 3. Windows 배치 파일
```cmd
# 챗봇 로그 조회
run_log_manager.bat view fastapi chatbot

# 통계 확인
run_log_manager.bat stats
```

## 📈 분석 가능한 데이터
1. **사용자 행동 패턴**
   - 자주 묻는 질문 유형
   - 이용 시간대 분석
   - 부서별 질의 빈도

2. **챗봇 성능**
   - 평균 응답 시간
   - 응답 품질 분석
   - 오류 발생 빈도

3. **서비스 개선**
   - 인식되지 않는 부서명
   - 처리되지 않는 질문 패턴
   - 사용자 만족도 추정

## 🔧 설정 옵션
- **로그 보관 기간**: 30일 (기본)
- **파일 로테이션**: 일별
- **개인정보 마스킹**: 자동 적용
- **실시간 모니터링**: 지원

## 🚨 주의사항
- 민감한 개인정보가 포함될 수 있으므로 접근 권한을 엄격히 관리
- 로그 파일은 정기적으로 백업 및 삭제 필요
- GDPR 등 개인정보 보호 규정 준수 필요

## 🎭 익명화 정책
- 실제 환자 정보는 로깅되지 않음
- 의료진 이름과 연락처는 업무상 필요한 범위에서만 기록
- IP 주소는 시스템 보안 목적으로만 활용

## 📞 문의
로깅 시스템 관련 문의사항이 있으시면 시스템 관리자에게 연락해주세요. 